<!DOCTYPE html>
<html>
  <head>
    <title>WebSocket Sensor Data</title>
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
      integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="http://cdn.rawgit.com/Mikhus/canvas-gauges/gh-pages/download/2.1.7/all/gauge.min.js"></script>
  </head>
  <body>
    <div class="topnav">
      <h1>ESP WEB SERVER GAUGES</h1>
    </div>
    <h2>Sensor Data</h2>
    <div class="main-container">
      <div class="content">
        <div class="card-grid">
          <div class="card">
            <p class="card-title">Temperature</p>
            <canvas id="temperature"></canvas>
          </div>
          <div class="card">
            <p class="card-title">Humidity</p>
            <canvas id="humidity"></canvas>
          </div>
          <div class="card">
            <p class="card-title">Jarak</p>
            <canvas id="potensiometer"></canvas>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="card-grid-bottom">
          <div class="card">
            <p class="card-title">Jarak dari Benda di Depan</p>
            <p id="distance"></p>
          </div>
          <div class="card">
            <p class="card-title">Sudut Gyro</p>
            <p id="gyro"></p>
          </div>
        </div>
      </div>
    </div>

    <script defer>
      const websocket = new WebSocket("ws://192.168.43.190/ws");

      var gaugeTemp = new LinearGauge({
        renderTo: "temperature",
        width: 120,
        height: 400,
        units: "Temperature C",
        minValue: 0,
        startAngle: 90,
        ticksAngle: 180,
        maxValue: 40,
        colorValueBoxRect: "#049faa",
        colorValueBoxRectEnd: "#049faa",
        colorValueBoxBackground: "#f1fbfc",
        valueDec: 2,
        valueInt: 2,
        majorTicks: ["0", "5", "10", "15", "20", "25", "30", "35", "40"],
        minorTicks: 4,
        strokeTicks: true,
        highlights: [
          {
            from: 30,
            to: 40,
            color: "rgba(200, 50, 50, .75)",
          },
        ],
        colorPlate: "#fff",
        colorBarProgress: "#CC2936",
        colorBarProgressEnd: "#049faa",
        borderShadowWidth: 0,
        borders: false,
        needleType: "arrow",
        needleWidth: 2,
        needleCircleSize: 7,
        needleCircleOuter: true,
        needleCircleInner: false,
        animationDuration: 1500,
        animationRule: "linear",
        barWidth: 10,
      }).draw();

      // Create Humidity Gauge
      var gaugeHum = new RadialGauge({
        renderTo: "humidity",
        width: 300,
        height: 300,
        units: "Humidity (%)",
        minValue: 0,
        maxValue: 100,
        colorValueBoxRect: "#049faa",
        colorValueBoxRectEnd: "#049faa",
        colorValueBoxBackground: "#f1fbfc",
        valueInt: 2,
        majorTicks: ["0", "20", "40", "60", "80", "100"],
        minorTicks: 4,
        strokeTicks: true,
        highlights: [
          {
            from: 80,
            to: 100,
            color: "#03C0C1",
          },
        ],
        colorPlate: "#fff",
        borderShadowWidth: 0,
        borders: false,
        needleType: "line",
        colorNeedle: "#007F80",
        colorNeedleEnd: "#007F80",
        needleWidth: 2,
        needleCircleSize: 3,
        colorNeedleCircleOuter: "#007F80",
        needleCircleOuter: true,
        needleCircleInner: false,
        animationDuration: 1500,
        animationRule: "linear",
      }).draw();

      // Create Humidity Gauge
      var gaugePotensio = new RadialGauge({
        renderTo: "potensiometer",
        width: 300,
        height: 300,
        units: "Meter (m)",
        minValue: 0,
        maxValue: 100,
        colorValueBoxRect: "#049faa",
        colorValueBoxRectEnd: "#049faa",
        colorValueBoxBackground: "#f1fbfc",
        valueInt: 2,
        majorTicks: ["0", "20", "40", "60", "80", "100"],
        minorTicks: 4,
        strokeTicks: true,
        highlights: [
          {
            from: 80,
            to: 100,
            color: "#03C0C1",
          },
        ],
        colorPlate: "#fff",
        borderShadowWidth: 0,
        borders: false,
        needleType: "line",
        colorNeedle: "#007F80",
        colorNeedleEnd: "#007F80",
        needleWidth: 2,
        needleCircleSize: 3,
        colorNeedleCircleOuter: "#007F80",
        needleCircleOuter: true,
        needleCircleInner: false,
        animationDuration: 500,
        animationRule: "linear",
      }).draw();

      websocket.addEventListener("message", (event) => {
        gaugeTemp.value = JSON.parse(event.data).temperature;
        gaugePotensio.value = JSON.parse(event.data).potensiometer / 40.95;
        gaugeHum.value = JSON.parse(event.data).humidity;

        const distance = document.querySelector("#distance");
        const gyro = document.querySelector("#gyro");
        distance.innerHTML = JSON.parse(event.data).distance;
        // gyro.innerHTML = JSON.parse(event.data).gyro;
      });
    </script>
  </body>
</html>
